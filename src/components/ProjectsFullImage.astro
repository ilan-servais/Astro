---
import { getCollection } from 'astro:content';
import { Image } from 'astro:assets';
import project1Image from '@assets/images/project-1.svg';
import project2Image from '@assets/images/project-2.svg';
import project3Image from '@assets/images/project-3.svg';
import Tags from '@components/ui/Tags.astro';

// Utiliser un type plus spécifique pour éviter les erreurs "never"
const projects = await getCollection('projects', ({ data }) => {
    return !data.inProgress;
});
---

<section data-testid="projects" id="projects" class="mb-10 flex flex-col items-center justify-center md:mb-0 md:h-screen">
    <h2 class="font-monospace text-2xl text-orange lg:text-4xl">Top Projects</h2>
    <span class="mb-10 h-1 w-10 bg-orange"></span>
    <div class="grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3 w-full">
        {projects.map((project) => (
            <div class="rounded-xl overflow-hidden shadow-lg hover:scale-105 transition bg-white">
                <a 
                    href={`/project/${project.slug}`} 
                    aria-label={`View details of ${project.data.title}`}
                    class="block h-full flex flex-col"
                >
                    <div class="relative">
                        {project.data.image ? (
                            project.slug === 'project-1' ? (
                                <Image 
                                    src={project1Image} 
                                    alt={project.data.img_alt || 'Image du projet'} 
                                    width={400}
                                    height={400}
                                    class="w-full object-cover"
                                />
                            ) : project.slug === 'project-2' ? (
                                <Image 
                                    src={project2Image} 
                                    alt={project.data.img_alt || 'Image du projet'} 
                                    width={400}
                                    height={400}
                                    class="w-full h-auto object-cover"
                                />
                            ) : project.slug === 'project-3' ? (
                                <Image 
                                    src={project3Image} 
                                    alt={project.data.img_alt || 'Image du projet'} 
                                    width={400}
                                    height={400}
                                    class="w-full h-auto object-cover"
                                />
                            ) : (
                                <img 
                                    src={(project.data.image as string).toString()} 
                                    alt={(project.data.img_alt as string) || 'Image du projet'} 
                                    class="w-full h-auto object-cover"
                                />
                            )
                        ) : (
                            <img 
                                src="/default-image.png" 
                                alt="Image par défaut" 
                                class="w-full h-auto object-cover"
                            />
                        )}
                        
                        {/* Badge avec la date du projet */}
                        {project.data.date && (
                            <div class="absolute top-2 right-2 bg-black text-white text-xs font-bold px-2 py-1 rounded">
                                {project.data.date}
                            </div>
                        )}
                    </div>
                    <div class="p-4 flex flex-col flex-grow justify-end">
                        <h3 class="text-xl text-orange lg:text-2xl">{project.data.title}</h3>
                        <p class="text-s text-black mt-2">{project.data.description}</p>
                        <div class="mt-4">
                            <Tags tags={project.data.tags} />
                        </div>
                    </div>
                </a>
            </div>
        ))}
    </div>
    
    <a
        href="/projects"
        class="flex flex-row text-black hover:text-orange dark:text-white dark:hover:text-orange mt-8"
        aria-label="Browse all projects"
    >
        View all projects
        <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            class="ml-1 h-6 w-6"
        >
            <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M17.25 8.25L21 12m0 0l-3.75 3.75M21 12H3"></path>
        </svg>
    </a>
</section>